<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Account | AnGawa</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../styles/main.css">

</head>
<body>
  <section class="container forms">
    <div class="form signup">
      <div class="form-content">
          <div class="signup-header">Signup</header>
          <div class="signup-subheader">Fields marked with * are mandatory.</header>
          <form id="signup-form" action="">
              <div class="field input-field">
                  <div class="label"><label> First Name * </label></div>
                  <input id="first-name" type="text" placeholder="Enter first name" class="name" pattern="[A-Za-z]+" required>
              </div>

              <div class="field input-field">
                  <div class="label"><label> Middle Name </label></div>
                  <input id="middle-name" type="text" placeholder="Enter middle name" class="name" pattern="[A-Za-z]+" >
              </div>

              <div class="field input-field">
                  <div class="label"><label> Last Name * </label></div>
                  <input id="last-name" type="text" placeholder="Enter last name" class="name" pattern="[A-Za-z]+" required>
              </div>

              <div class="field input-field">
                  <div class="label"><label> Name Extension </label></div>
                  <input id="name-extension" type="text" placeholder="Enter name extension " class="name" pattern="(Sr.|Jr.|I|II|III|IV|V)">
              </div>

              <div class="column">
                  <div class="field input-field">
                      <div class="label"><label> Birth Date * </label></div>
                      <input id="birthdate" type="date" placeholder="Enter birth date" required>
                  </div>

                  <div class="field input-field">
                    <div class="label"><label> Gender * </label></div>                       
                      <select id="gender" name="gender" class="select">
                          <div class="label"> <option values=""> </option>
                              <option>Male</option>
                              <option>Female</option>
                              <option>Prefer not to say</option>
                          </div>
                      </select>
                  </div>
              </div>

              <div class="field input-field">
                  <div class="label"><label> Email Address * </label></div>
                  <input id="email" type="email" placeholder="Email" class="input" required>
              </div>

              <div class="password">
                  <div class="field input-field">
                      <div class="label"><label> Password * </label></div>
                      <input type="password" placeholder="Create password" id="password" class="password" required>
                  </div>

                  <div class="field input-field">
                      <div class="label"><label> Confirm password * </label></div>
                      <input type="password" placeholder="Confirm password" id="confirm-password"class="password" required>
                  </div>    
              </div>

              <div class="field button-field">
                  <div class="signup-button"><button type="submit">Signup</button></div>
              </div>
          </form>

          <div class="form-link">
              <span>Already have an account? <a href="./login.html" class="link login-link">Login</a></span>
          </div>
      </div>
  </div>
  </section>
  <script>
    var password = document.getElementById("password");
    var confirm_password = document.getElementById("confirm-password");

    function validatePassword() {
        if(password.value != confirm_password.value) {
            confirm_password.setCustomValidity("Passwords don't match");
        } else {
            confirm_password.setCustomValidity("");
        }
    }

    password.onchange = validatePassword;
    confirm_password.onkeyup = validatePassword;

    let signupForm = document.getElementById("signup-form");
    signupForm.addEventListener("submit", (e) => {
      e.preventDefault();

      let firstName = document.getElementById("first-name").value;
      let middleName = document.getElementById("middle-name").value;
      let lastName = document.getElementById("last-name").value;
      let nameExtension = document.getElementById("name-extension").value;
      let birthdate = document.getElementById("birthdate").value;
      let gender = document.getElementById("gender").value;
      let email = document.getElementById("email").value;
      let password = document.getElementById("password").value;
      let confirmPassword = document.getElementById("confirm-password").value;

      // need bcrypt
      let pw_hash = password;

      async function createUser(firstName, middleName, lastName, nameExtension, birthdate, gender, email, pw_hash) {
        try {
          const response = await fetch("http://localhost:5000/api/register", {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              "first_name": firstName,
              "middle_name": middleName,
              "last_name": lastName,
              "name_ext": nameExtension,
              "birthdate": birthdate,
              "gender": gender,
              "email": email,
              "pw_hash": pw_hash,
            }),
          });

          const result = await response.json();
          return result;

        } catch (error) {
          console.error("Error:", error);
          return null;
        }
      }

      let result = createUser(firstName, middleName, lastName, nameExtension, birthdate, gender, email, pw_hash);
      console.log(result);
    });
</script>
</body>
</html>